# üöÄ Render Deployment Guide - PaperPathAI

## üîß Fixed Deployment Issues

The deployment error you encountered has been resolved with these fixes:

### ‚úÖ **What We Fixed**
1. **Python Version**: Added `runtime.txt` specifying Python 3.11.9
2. **Dependencies**: Updated to compatible package versions
3. **Build Process**: Improved build script with pip upgrade
4. **Health Checks**: Added monitoring endpoints
5. **Alternative Config**: Added Procfile for flexibility

## üöÄ **Step-by-Step Deployment**

### 1. **Deploy Backend Service**

1. **Go to Render Dashboard**: https://dashboard.render.com
2. **Create New Web Service**:
   - Click "New" ‚Üí "Web Service"
   - Connect GitHub: `Muzamilz/PaperPathAI`
   - **Name**: `paperpathAI-backend`
   - **Root Directory**: `backend`
   - **Build Command**: `./build.sh`
   - **Start Command**: `gunicorn config.wsgi:application`

3. **Environment Variables** (Add these in Render dashboard):
   ```bash
   DEBUG=false
   SECRET_KEY=[auto-generated by Render]
   ALLOWED_HOSTS=*
   
   # Will be auto-set when you add database/redis
   DATABASE_URL=[auto-linked]
   REDIS_URL=[auto-linked]
   CELERY_BROKER_URL=[auto-linked]
   CELERY_RESULT_BACKEND=[auto-linked]
   
   # Update these with your actual URLs after deployment
   CORS_ALLOWED_ORIGINS=https://your-frontend-url.onrender.com
   FRONTEND_URL=https://your-frontend-url.onrender.com
   
   # Email configuration (Gmail)
   EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
   EMAIL_HOST=smtp.gmail.com
   EMAIL_PORT=587
   EMAIL_USE_TLS=true
   EMAIL_HOST_USER=your-email@gmail.com
   EMAIL_HOST_PASSWORD=your-gmail-app-password
   DEFAULT_FROM_EMAIL=noreply@paperpathAI.com
   ```

### 2. **Add Database (PostgreSQL)**

1. **Create Database**:
   - Go to Dashboard ‚Üí "New" ‚Üí "PostgreSQL"
   - **Name**: `paperpathAI-db`
   - **Database Name**: `paperpathAI`
   - **User**: `paperpathAI_user`

2. **Link to Backend**:
   - The `DATABASE_URL` will be automatically linked to your web service

### 3. **Add Redis (for Celery)**

1. **Create Redis**:
   - Go to Dashboard ‚Üí "New" ‚Üí "Redis"
   - **Name**: `paperpathAI-redis`

2. **Link to Backend**:
   - The `REDIS_URL` will be automatically linked

### 4. **Deploy Celery Worker**

1. **Create Background Worker**:
   - Go to Dashboard ‚Üí "New" ‚Üí "Background Worker"
   - Connect same GitHub repository
   - **Name**: `paperpathAI-celery-worker`
   - **Root Directory**: `backend`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `celery -A config worker -l info`

2. **Environment Variables**: Same as backend service

### 5. **Deploy Celery Beat (Optional - for periodic tasks)**

1. **Create Background Worker**:
   - **Name**: `paperpathAI-celery-beat`
   - **Root Directory**: `backend`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `celery -A config beat -l info`

2. **Environment Variables**: Same as backend service

### 6. **Deploy Frontend**

1. **Create Static Site**:
   - Go to Dashboard ‚Üí "New" ‚Üí "Static Site"
   - Connect same GitHub repository
   - **Name**: `paperpathAI-frontend`
   - **Root Directory**: `frontend`
   - **Build Command**: `npm ci && npm run build`
   - **Publish Directory**: `dist`

2. **Environment Variables**:
   ```bash
   VITE_API_BASE_URL=https://your-backend-url.onrender.com/api
   VITE_APP_NAME=PaperPathAI
   VITE_APP_DESCRIPTION=Professional Student Services Platform
   ```

## üîç **Testing Your Deployment**

### 1. **Health Check**
Once deployed, test these endpoints:
```bash
# Health check
curl https://your-backend-url.onrender.com/health/

# Readiness check
curl https://your-backend-url.onrender.com/ready/
```

### 2. **API Test**
```bash
# Test API overview
curl https://your-backend-url.onrender.com/api/

# Test services endpoint
curl https://your-backend-url.onrender.com/api/services/
```

### 3. **Frontend Test**
- Visit your frontend URL
- Test language switching (English/Arabic)
- Submit a test service request
- Check if emails are sent

## üìß **Email Setup (Gmail)**

### 1. **Enable 2-Factor Authentication**
- Go to your Google Account settings
- Security ‚Üí 2-Step Verification ‚Üí Turn on

### 2. **Generate App Password**
- Google Account ‚Üí Security ‚Üí 2-Step Verification
- Scroll down to "App passwords"
- Select "Mail" and generate password
- Use this password as `EMAIL_HOST_PASSWORD`

### 3. **Test Email System**
Once deployed, you can test emails via the admin panel or API.

## üêõ **Troubleshooting**

### **Build Fails**
1. Check the build logs in Render dashboard
2. Verify `runtime.txt` specifies Python 3.11.9
3. Check if all requirements are compatible

### **Database Connection Issues**
1. Ensure PostgreSQL service is running
2. Check if `DATABASE_URL` is properly linked
3. Look for migration errors in logs

### **Celery Not Working**
1. Verify Redis service is running
2. Check `REDIS_URL` environment variable
3. Look at worker logs for errors

### **Email Not Sending**
1. Verify Gmail app password is correct
2. Check email environment variables
3. Look at Celery worker logs for email task errors

### **CORS Issues**
1. Update `CORS_ALLOWED_ORIGINS` with actual frontend URL
2. Ensure both HTTP and HTTPS are included if needed

## üìä **Monitoring**

### **Logs**
- **Backend**: Render Dashboard ‚Üí Backend Service ‚Üí Logs
- **Worker**: Render Dashboard ‚Üí Worker Service ‚Üí Logs
- **Frontend**: Render Dashboard ‚Üí Static Site ‚Üí Deploy Logs

### **Health Monitoring**
- Use the `/health/` endpoint for basic health checks
- Use the `/ready/` endpoint for readiness probes
- Monitor email delivery through admin dashboard

## üîÑ **Auto-Deploy**

Render automatically deploys when you push to the `main` branch. To trigger a manual deploy:
1. Go to your service in Render dashboard
2. Click "Manual Deploy" ‚Üí "Deploy latest commit"

## üéØ **Expected Results**

After successful deployment, you should have:

### ‚úÖ **Working Features**
- **Multilingual Website**: Arabic RTL + English LTR
- **Service Requests**: Clients can submit requests
- **Email Notifications**: Automatic confirmations and updates
- **Admin Dashboard**: Complete request management
- **Background Tasks**: Email processing working
- **Health Monitoring**: Status endpoints responding

### üìß **Email Flow**
1. Client submits request ‚Üí Gets confirmation email
2. Admin gets notification email
3. Admin changes status ‚Üí Client gets update email
4. Daily maintenance emails for overdue requests

### üåê **URLs**
- **Frontend**: `https://paperpathAI-frontend.onrender.com`
- **Backend API**: `https://paperpathAI-backend.onrender.com/api`
- **Admin Panel**: `https://paperpathAI-backend.onrender.com/admin`
- **API Docs**: `https://paperpathAI-backend.onrender.com/api/docs`

## üÜò **Need Help?**

If you encounter issues:
1. Check the specific error in Render logs
2. Compare with this guide
3. Test locally first to isolate the issue
4. Check GitHub issues for similar problems

---

**üéâ Your PaperPathAI platform should now deploy successfully!**
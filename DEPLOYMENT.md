# üöÄ Deployment Guide - Student Services Website

This guide covers deploying the Student Services website to production using Render.

## üìã Prerequisites

- GitHub account
- Render account (free tier available)
- Gmail account for email notifications (or other SMTP provider)

## üèóÔ∏è Architecture Overview

The application consists of:
- **Frontend**: Vue.js SPA served by Vite
- **Backend**: Django REST API with PostgreSQL database
- **Background Tasks**: Celery workers with Redis broker
- **Email System**: SMTP-based notifications with multilingual support

## üì¶ Deployment Steps

### Step 1: Prepare GitHub Repository

1. **Create a new GitHub repository**
   ```bash
   git init
   git add .
   git commit -m "Initial commit: Student Services website with email notifications"
   git branch -M main
   git remote add origin https://github.com/yourusername/student-services-website.git
   git push -u origin main
   ```

### Step 2: Deploy Backend to Render

1. **Go to Render Dashboard** ‚Üí Create New ‚Üí Web Service
2. **Connect GitHub repository**
3. **Configure the service:**
   - **Name**: `student-services-backend`
   - **Environment**: `Python`
   - **Build Command**: `./build.sh`
   - **Start Command**: `gunicorn config.wsgi:application`
   - **Root Directory**: `backend`

4. **Add Environment Variables:**
   ```
   DEBUG=false
   SECRET_KEY=[auto-generated by Render]
   ALLOWED_HOSTS=*
   CORS_ALLOWED_ORIGINS=https://student-services-frontend.onrender.com
   FRONTEND_URL=https://student-services-frontend.onrender.com
   
   # Email Configuration
   EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
   EMAIL_HOST=smtp.gmail.com
   EMAIL_PORT=587
   EMAIL_USE_TLS=true
   EMAIL_HOST_USER=your-email@gmail.com
   EMAIL_HOST_PASSWORD=your-app-password
   DEFAULT_FROM_EMAIL=noreply@studentservices.com
   ```

5. **Add Database** (PostgreSQL):
   - Go to Dashboard ‚Üí Create New ‚Üí PostgreSQL
   - Name: `student-services-db`
   - The `DATABASE_URL` will be automatically linked

6. **Add Redis** (for Celery):
   - Go to Dashboard ‚Üí Create New ‚Üí Redis
   - Name: `student-services-redis`
   - The `REDIS_URL` will be automatically linked

### Step 3: Deploy Celery Workers

1. **Create Celery Worker Service:**
   - **Name**: `student-services-celery-worker`
   - **Environment**: `Python`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `celery -A config worker -l info`
   - **Root Directory**: `backend`
   - **Same environment variables as backend**

2. **Create Celery Beat Service:**
   - **Name**: `student-services-celery-beat`
   - **Environment**: `Python`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `celery -A config beat -l info`
   - **Root Directory**: `backend`
   - **Same environment variables as backend**

### Step 4: Deploy Frontend to Render

1. **Create Web Service:**
   - **Name**: `student-services-frontend`
   - **Environment**: `Node`
   - **Build Command**: `npm ci && npm run build`
   - **Start Command**: `npm run preview -- --host 0.0.0.0 --port $PORT`
   - **Root Directory**: `frontend`

2. **Environment Variables:**
   ```
   NODE_VERSION=18.17.0
   VITE_API_BASE_URL=https://student-services-backend.onrender.com/api
   VITE_APP_NAME=Student Services
   ```

## üîß Configuration Details

### Email Setup (Gmail)

1. **Enable 2-Factor Authentication** on your Gmail account
2. **Generate App Password:**
   - Go to Google Account Settings
   - Security ‚Üí 2-Step Verification ‚Üí App passwords
   - Generate password for "Mail"
3. **Use the app password** as `EMAIL_HOST_PASSWORD`

### Environment Variables Reference

#### Backend Environment Variables
```bash
# Core Django Settings
DEBUG=false
SECRET_KEY=your-secret-key
ALLOWED_HOSTS=your-backend-domain.onrender.com
CORS_ALLOWED_ORIGINS=https://your-frontend-domain.onrender.com

# Database (Auto-configured by Render)
DATABASE_URL=postgresql://user:pass@host:port/db

# Redis/Celery (Auto-configured by Render)
REDIS_URL=redis://host:port
CELERY_BROKER_URL=redis://host:port
CELERY_RESULT_BACKEND=redis://host:port

# Email Configuration
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=true
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=noreply@studentservices.com

# Frontend URL for email links
FRONTEND_URL=https://your-frontend-domain.onrender.com
```

#### Frontend Environment Variables
```bash
NODE_VERSION=18.17.0
VITE_API_BASE_URL=https://your-backend-domain.onrender.com/api
VITE_APP_NAME=Student Services
VITE_APP_DESCRIPTION=Professional student services platform
```

## üß™ Testing Production Deployment

### 1. Test API Endpoints
```bash
# Health check
curl https://your-backend-domain.onrender.com/api/

# Test service requests
curl https://your-backend-domain.onrender.com/api/requests/public/requests/
```

### 2. Test Email System
```bash
# SSH into your backend service (if available) or use Django admin
python manage.py test_email_notifications --email-type=all --language=en
```

### 3. Test Frontend
- Visit your frontend URL
- Test form submissions
- Check multilingual support (English/Arabic)
- Verify admin dashboard functionality

## üìä Monitoring & Maintenance

### Logs
- **Backend Logs**: Render Dashboard ‚Üí Backend Service ‚Üí Logs
- **Celery Worker Logs**: Render Dashboard ‚Üí Worker Service ‚Üí Logs
- **Frontend Logs**: Render Dashboard ‚Üí Frontend Service ‚Üí Logs

### Database Management
```bash
# Access database via Render dashboard
# Or connect using DATABASE_URL with psql or pgAdmin
```

### Email Monitoring
- Check email delivery in Django admin
- Monitor failed emails via API endpoints
- Use management commands for maintenance

### Scheduled Tasks
Celery Beat automatically runs:
- **Daily**: Overdue request notifications
- **Weekly**: Attachment cleanup
- **On-demand**: Status update emails

## üîí Security Considerations

### Production Security Checklist
- ‚úÖ DEBUG=False in production
- ‚úÖ Strong SECRET_KEY (auto-generated by Render)
- ‚úÖ HTTPS enforced by Render
- ‚úÖ Database credentials secured
- ‚úÖ Email credentials secured
- ‚úÖ CORS properly configured
- ‚úÖ Static files served securely

### Email Security
- ‚úÖ App passwords instead of main password
- ‚úÖ TLS encryption for SMTP
- ‚úÖ No sensitive data in email content
- ‚úÖ Rate limiting on email sending

## üö® Troubleshooting

### Common Issues

1. **Build Failures**
   - Check Python/Node versions
   - Verify requirements.txt/package.json
   - Check build logs for specific errors

2. **Database Connection Issues**
   - Verify DATABASE_URL is set
   - Check PostgreSQL service status
   - Run migrations manually if needed

3. **Email Not Sending**
   - Verify SMTP credentials
   - Check Gmail app password
   - Monitor Celery worker logs

4. **Static Files Not Loading**
   - Verify WhiteNoise configuration
   - Check STATIC_ROOT and STATIC_URL
   - Run collectstatic manually

5. **CORS Issues**
   - Verify CORS_ALLOWED_ORIGINS
   - Check frontend/backend URLs match
   - Ensure credentials are allowed

### Debug Commands
```bash
# Check service status
python manage.py check --deploy

# Test database connection
python manage.py dbshell

# Test email configuration
python manage.py shell -c "from django.core.mail import send_mail; send_mail('Test', 'Test message', 'from@example.com', ['to@example.com'])"

# Check Celery workers
celery -A config inspect active
```

## üìà Performance Optimization

### Backend Optimization
- Database query optimization
- Redis caching for frequent queries
- Celery task optimization
- Static file compression

### Frontend Optimization
- Vite build optimization
- Asset compression
- Lazy loading for routes
- Image optimization

## üîÑ CI/CD Pipeline (Optional)

For automated deployments, you can set up GitHub Actions:

```yaml
# .github/workflows/deploy.yml
name: Deploy to Render
on:
  push:
    branches: [main]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Trigger Render Deploy
        run: |
          curl -X POST "https://api.render.com/deploy/srv-YOUR_SERVICE_ID?key=YOUR_DEPLOY_KEY"
```

## üìû Support

If you encounter issues:
1. Check the logs in Render dashboard
2. Review this deployment guide
3. Check Django/Vue.js documentation
4. Contact support with specific error messages

---

**üéâ Congratulations!** Your Student Services website with email notifications is now deployed and ready for production use!